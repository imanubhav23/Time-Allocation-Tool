<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Allocation Tool</title>
    <style>
        /* Your existing CSS remains the same */
        .graph-container {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .area-chart {
            width: 100%;
            height: 400px;
            position: relative;
            margin-top: 20px;
            padding: 20px 40px 40px 60px;
        }

        .chart-svg {
            width: 100%;
            height: 100%;
        }

        .area-path {
            fill-opacity: 0.6;
            transition: all 0.3s ease;
        }

        .area-path:hover {
            fill-opacity: 0.8;
        }

        .axis-line {
            stroke: #ddd;
            stroke-width: 1;
        }

        .axis-label {
            font-size: 12px;
            fill: #666;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }

        /* Rest of your existing CSS */
    </style>
</head>
<body>
    <!-- Your existing HTML structure remains the same until the results div -->
    
    <div id="results" class="results">
        <h2>Your Time Allocation Results</h2>
        <div class="progress-bar" id="timeBar"></div>
        <div class="insight" id="insight"></div>
        <div class="viz-container">
            <div class="treemap" id="timeTreemap"></div>
        </div>
        <!-- Add this new section for the area chart -->
        <div class="graph-container">
            <h3>Time Distribution Area Chart</h3>
            <div class="area-chart" id="timeAreaChart"></div>
            <div class="chart-legend" id="chartLegend"></div>
        </div>
        <div class="insights" id="timeInsights"></div>
    </div>

    <script>
        // First, let's fix the core functions
        function startTool() {
            document.getElementById('content').style.display = 'block';
            document.querySelector('.landing').style.display = 'none';
        }

        function collectData() {
            const investments = Array.from(document.querySelectorAll('#investments-list .activity-box'))
                .map(box => ({
                    name: box.querySelector('label')?.textContent.replace(':', '') || 
                          box.querySelector('input[type="text"]')?.value || 'Other',
                    value: Number(box.querySelector('input[type="number"]').value),
                    category: 'Investments'
                }))
                .filter(item => item.value > 0);

            const distractions = Array.from(document.querySelectorAll('#distractions-list .activity-box'))
                .map(box => ({
                    name: box.querySelector('label')?.textContent.replace(':', '') || 
                          box.querySelector('input[type="text"]')?.value || 'Other',
                    value: Number(box.querySelector('input[type="number"]').value),
                    category: 'Distractions'
                }))
                .filter(item => item.value > 0);

            const fixed = Array.from(document.querySelectorAll('.fixed-activities .activity-box'))
                .map(box => ({
                    name: box.querySelector('label').textContent.replace(':', ''),
                    value: Number(box.querySelector('input[type="number"]').value),
                    category: 'Fixed'
                }))
                .filter(item => item.value > 0);

            return [...investments, ...distractions, ...fixed];
        }

        function createAreaChart(data) {
            const container = document.getElementById('timeAreaChart');
            const width = container.clientWidth - 100;
            const height = container.clientHeight - 60;
            
            // Group data by category
            const categories = ['Investments', 'Distractions', 'Fixed'];
            const categoryColors = {
                'Investments': '#4CAF50',
                'Distractions': '#f44336',
                'Fixed': '#2196F3'
            };
            
            // Create time points (0 to 24 hours)
            const timePoints = Array.from({length: 25}, (_, i) => i);
            
            // Create stacked data
            const stackedData = timePoints.map(hour => {
                const point = { hour };
                let cumulative = 0;
                
                categories.forEach(category => {
                    const categoryItems = data.filter(item => item.category === category);
                    const categoryValue = categoryItems.reduce((sum, item) => {
                        return sum + (item.value / 24);
                    }, 0);
                    
                    point[category + 'Start'] = cumulative;
                    cumulative += categoryValue;
                    point[category + 'End'] = cumulative;
                });
                
                return point;
            });
            
            // Create SVG
            container.innerHTML = `
                <svg class="chart-svg" viewBox="0 0 ${width} ${height}">
                    ${Array.from({length: 6}, (_, i) => {
                        const y = height - (height * i / 5);
                        const value = (7 * i).toFixed(1);
                        return `
                            <line class="axis-line" x1="0" y1="${y}" x2="${width}" y2="${y}" />
                            <text class="axis-label" x="-10" y="${y}" text-anchor="end" dominant-baseline="middle">
                                ${value}h
                            </text>
                        `;
                    }).join('')}
                    
                    ${Array.from({length: 13}, (_, i) => {
                        const x = (width * i / 12);
                        return `
                            <line class="axis-line" x1="${x}" y1="0" x2="${x}" y2="${height}" />
                            <text class="axis-label" x="${x}" y="${height + 20}" text-anchor="middle">
                                ${i * 2}:00
                            </text>
                        `;
                    }).join('')}
                    
                    ${categories.map(category => {
                        const points = stackedData.map(point => {
                            const x = (point.hour / 24) * width;
                            const yStart = height - (point[category + 'Start'] / 7) * height;
                            const yEnd = height - (point[category + 'End'] / 7) * height;
                            return { x, yStart, yEnd };
                        });
                        
                        const pathD = `
                            M ${points[0].x} ${points[0].yEnd}
                            ${points.map(p => `L ${p.x} ${p.yEnd}`).join(' ')}
                            L ${points[points.length-1].x} ${points[points.length-1].yStart}
                            ${points.reverse().map(p => `L ${p.x} ${p.yStart}`).join(' ')}
                            Z
                        `;
                        
                        return `
                            <path class="area-path" d="${pathD}" 
                                  fill="${categoryColors[category]}"
                                  data-category="${category}">
                                <title>${category}</title>
                            </path>
                        `;
                    }).join('')}
                </svg>
            `;
            
            // Create legend
            const legend = document.getElementById('chartLegend');
            legend.innerHTML = categories.map(category => `
                <div class="legend-item" data-category="${category}">
                    <div class="legend-color" style="background: ${categoryColors[category]}"></div>
                    <span>${category}</span>
                </div>
            `).join('');
            
            // Add legend interactivity
            legend.querySelectorAll('.legend-item').forEach(item => {
                item.addEventListener('mouseover', () => {
                    const category = item.dataset.category;
                    container.querySelectorAll('.area-path').forEach(path => {
                        if (path.dataset.category !== category) {
                            path.style.fillOpacity = '0.2';
                        }
                    });
                });
                
                item.addEventListener('mouseout', () => {
                    container.querySelectorAll('.area-path').forEach(path => {
                        path.style.fillOpacity = '0.6';
                    });
                });
            });
        }

        function calculateResults() {
            const total = Number(document.getElementById('totalHoursSpent').textContent);
            if (total !== 168) {
                return;
            }

            const investments = Array.from(document.querySelectorAll('#investments-list input[type="number"]'))
                .reduce((sum, input) => sum + Number(input.value), 0);
            
            const distractions = Array.from(document.querySelectorAll('#distractions-list input[type="number"]'))
                .reduce((sum, input) => sum + Number(input.value), 0);
            
            const sleep = Number(document.querySelector('.fixed-activities input[value="56"]').value);
            const work = Number(document.querySelector('.fixed-activities input[value="40"]').value);
            
            const percentages = {
                investments: (investments / 168) * 100,
                distractions: (distractions / 168) * 100,
                sleep: (sleep / 168) * 100,
                work: (work / 168) * 100
            };

            // Update the time bar
            const timeBar = document.getElementById('timeBar');
            timeBar.innerHTML = '';
            
            const colors = {
                investments: '#4CAF50',
                distractions: '#f44336',
                sleep: '#2196F3',
                work: '#FFC107'
            };

            Object.entries(percentages).forEach(([category, percentage]) => {
                if (percentage > 0) {
                    const segment = document.createElement('div');
                    segment.className = 'progress-segment';
                    segment.style.width = `${percentage}%`;
                    segment.style.backgroundColor = colors[category];
                    segment.textContent = `${category}: ${percentage.toFixed(1)}%`;
                    timeBar.appendChild(segment);
                }
            });

            // Update insight
            const ratio = distractions / investments;
            const insight = document.getElementById('insight');
            if (distractions > investments) {
                insight.textContent = `You spend ${ratio.toFixed(1)} times more time on distractions than investments.`;
            } else if (investments > distractions) {
                insight.textContent = `You spend ${(1/ratio).toFixed(1)} times more time on investments than distractions.`;
            } else {
                insight.textContent = `Your time is equally split between investments and distractions.`;
            }

            // Show results and create visualizations
            document.getElementById('results').style.display = 'block';
            document.getElementById('content').style.display = 'none';
            
            createTimeVisualization();
            const data = collectData();
            createAreaChart(data);
        }

        // Add event listeners
        window.addEventListener('resize', () => {
            if (document.getElementById('results').style.display === 'block') {
                createTimeVisualization();
                const data = collectData();
                createAreaChart(data);
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const allInputs = document.querySelectorAll('input[type="number"]');
            allInputs.forEach(input => {
                input.setAttribute('max', '168');
                input.addEventListener('input', function() {
                    if (this.value > 168) {
                        this.value = 168;
                    }
                    if (this.value < 0) {
                        this.value = 0;
                    }
                    updateTotal();
                });
            });
            updateTotal();
        });

        // Keep your existing createTimeVisualization and other functions
    </script>
</body>
</html>
