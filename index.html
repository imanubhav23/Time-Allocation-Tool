<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Allocation Tool</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        /* (Keep your existing styles) */
    </style>
</head>
<body>
    <!-- Existing HTML content -->

    <div id="results" class="results">
        <h2>Your Time Allocation Results</h2>
        <div class="progress-bar" id="timeBar"></div>
        <div class="insight" id="insight"></div>
        <button class="view-insights-btn" onclick="viewInsights()">View Insights</button>
    </div>

    <!-- Add the Sankey diagram container -->
    <div id="sankey-diagram" style="width: 100%; height: 400px; display: none;"></div>

    <script>
        google.charts.load('current', {packages: ['sankey']});
        
        function startTool() {
            document.getElementById('content').style.display = 'block';
            document.querySelector('.landing').style.display = 'none';
        }

        function addNewActivity(listId) {
            const list = document.getElementById(listId);
            const newBox = document.createElement('div');
            newBox.className = 'activity-box';
            
            const input = document.createElement('div');
            input.className = 'activity-input';
            
            input.innerHTML = `
                <input type="text" placeholder="Enter activity name" style="font-size: var(--font-size);">
                <input type="number" min="0" max="168" value="0" style="font-size: var(--font-size);">
                <span style="font-size: var(--font-size);">hours/week</span>
            `;
            
            newBox.appendChild(input);
            list.appendChild(newBox);
        }

        function calculateResults() {
            // Calculate total hours for each category
            const investments = Array.from(document.querySelectorAll('#investments-list input[type="number"]'))
                .reduce((sum, input) => sum + Number(input.value), 0);
            
            const distractions = Array.from(document.querySelectorAll('#distractions-list input[type="number"]'))
                .reduce((sum, input) => sum + Number(input.value), 0);
            
            const sleep = Number(document.querySelector('.fixed-activities input[value="56"]').value);
            const work = Number(document.querySelector('.fixed-activities input[value="40"]').value);
            
            const total = 168; // Total hours in a week
            const unaccounted = total - (investments + distractions + sleep + work);

            // Calculate percentages
            const percentages = {
                investments: (investments / total) * 100,
                distractions: (distractions / total) * 100,
                sleep: (sleep / total) * 100,
                work: (work / total) * 100,
                unaccounted: (unaccounted / total) * 100
            };

            // Update progress bar
            const timeBar = document.getElementById('timeBar');
            timeBar.innerHTML = '';
            
            const colors = {
                investments: '#4CAF50',
                distractions: '#f44336',
                sleep: '#2196F3',
                work: '#FFC107',
                unaccounted: '#9E9E9E'
            };

            Object.entries(percentages).forEach(([category, percentage]) => {
                if (percentage > 0) {
                    const segment = document.createElement('div');
                    segment.className = 'progress-segment';
                    segment.style.width = `${percentage}%`;
                    segment.style.backgroundColor = colors[category];
                    segment.textContent = `${category}: ${percentage.toFixed(1)}%`;
                    timeBar.appendChild(segment);
                }
            });

            // Generate insight
            const ratio = distractions / investments;
            const insight = document.getElementById('insight');
            if (distractions > investments) {
                insight.textContent = `You spend ${ratio.toFixed(1)} times more time on distractions than investments.`;
            } else if (investments > distractions) {
                insight.textContent = `You spend ${(1/ratio).toFixed(1)} times more time on investments than distractions.`;
            } else {
                insight.textContent = `Your time is equally split between investments and distractions.`;
            }

            // Show results and button to view insights
            document.getElementById('results').style.display = 'block';
            document.getElementById('content').style.display = 'none';
        }

        function viewInsights() {
            const investments = Array.from(document.querySelectorAll('#investments-list input[type="number"]'))
                .reduce((sum, input) => sum + Number(input.value), 0);
            const distractions = Array.from(document.querySelectorAll('#distractions-list input[type="number"]'))
                .reduce((sum, input) => sum + Number(input.value), 0);
            const sleep = Number(document.querySelector('.fixed-activities input[value="56"]').value);
            const work = Number(document.querySelector('.fixed-activities input[value="40"]').value);

            // Prepare data for Sankey diagram
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'From');
            data.addColumn('string', 'To');
            data.addColumn('number', 'Hours');

            // Add flows (Here we divide the activities into categories)
            data.addRows([
                ['Investments', 'Sleep', sleep],
                ['Investments', 'Work', work],
                ['Investments', 'Distractions', distractions],
                ['Investments', 'Investments', investments],
                ['Distractions', 'Sleep', sleep],
                ['Distractions', 'Work', work],
                ['Distractions', 'Distractions', distractions],
            ]);

            // Create and draw Sankey diagram
            const chart = new google.visualization.Sankey(document.getElementById('sankey-diagram'));
            chart.draw(data);

            // Show the Sankey diagram
            document.getElementById('sankey-diagram').style.display = 'block';
        }
    </script>
</body>
</html>
